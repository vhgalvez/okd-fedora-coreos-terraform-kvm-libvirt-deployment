variant: flatcar
version: 1.1.0

ignition:
  version: 3.4.0

passwd:
  users:
    - name: core
      ssh_authorized_keys:
        - "${ssh_keys}"
    - name: root
      password_hash: $6$hNh1nwO5OWWct4aZ$OoeAkQ4gKNBnGYK0ECi8saBMbUNeQRMICcOPYEu1bFuj9Axt4Rh6EnGba07xtIsGNt2wP9SsPlz543gfJww11/

storage:
  files:
    - path: /etc/hostname
      filesystem: "root"
      mode: 0644
      contents:
        inline: "${host_name}"
    - path: /home/core/works
      filesystem: "root"
      mode: 0755
      contents:
        inline: |
          #!/bin/bash
          set -euo pipefail
          echo My name is ${name} and the hostname is ${host_name}
    - path: /etc/sysconfig/network-scripts/route-eth0
      filesystem: "root"
      mode: 0644
      contents:
        inline: |
          default via ${gateway} dev eth0
          default via ${gateway} dev eth0 proto dhcp src ${ip} metric 1024
          10.17.4.0/24 dev eth0 proto kernel scope link src ${ip} metric 1024
          ${gateway} dev eth0 proto dhcp scope link src ${ip} metric 1024

systemd:
  units:
    - name: network-scripts.service
      enabled: true
      contents: |
        [Unit]
        Description=Apply network-scripts configurations
        After=network.target

        [Service]
        Type=oneshot
        ExecStart=/usr/sbin/ifup eth0
        RemainAfterExit=true

        [Install]
        WantedBy=multi-user.target
